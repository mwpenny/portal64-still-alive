cutscenes:
  START:
    - q_sound AMBIENCE_BASE CH_AMBIENT StringIdNone 0.55
  INTRO:
    - start_cutscene SIGNAGE
    - q_sound 11_PART1_ENTRY_1 CH_GLADOS PORTAL_11_PART1_ENTRY_1
    - q_sound 11_PART1_ENTRY_2 CH_GLADOS PORTAL_11_PART1_ENTRY_2
    - q_sound 11_PART1_ENTRY_3 CH_GLADOS PORTAL_11_PART1_ENTRY_3
    - wait_for_channel CH_GLADOS
    - set_signal entry_door
    - start_cutscene CUBE_DROPPER
    - start_cutscene CUBE_DROPPER_SPARKS_1
    - start_cutscene CUBE_DROPPER_SPARKS_2
    - play_animation fan fan_rotate 1 Loop
    - save_checkpoint
  SIGNAGE:
    - delay 4
    - activate_signage 16
  FINISH:
    - q_sound 11_PART1_SUCCESS_1 CH_GLADOS PORTAL_11_PART1_SUCCESS_1
  CHECKPOINT_1:
    - save_checkpoint
  CHECKPOINT_2:
    - save_checkpoint
  CHECKPOINT_3:
    - save_checkpoint
  WALL_GLITCH:
    - wait_for_signal not_cube_near_wall 5

    - play_animation moving_wall wall_glitch

    - delay 0.15
    - play_effect Spark moving_wall_spark_1
    - start_sound ZAP1 1 1 moving_wall_spark_1

    - delay 0.1
    - play_effect Spark moving_wall_spark_2
    - start_sound ZAP2 1 1 moving_wall_spark_2

    - delay 0.1
    - play_effect Spark moving_wall_spark_1
    - start_sound ZAP3 1 1 moving_wall_spark_1

    - delay 0.1
    - play_effect Spark moving_wall_spark_2
    - start_sound ZAP2 1 1 moving_wall_spark_2

    - delay 0.07
    - play_effect Spark moving_wall_spark_1
    - start_sound ZAP1 1 1 moving_wall_spark_1
  RATTMANN_DEN:
    - q_sound PORTAL_NO_CAKE_FOR_YOU CH_MUSIC
  CUBE_DROPPER:
    - label loop

    - wait_for_signal near_cube_dropper
    - delay_random 5 10
    - set_signal cube_dropper
    - delay 1
    - clear_signal cube_dropper

    - goto loop
  CUBE_DROPPER_SPARKS_1:
    - label loop

    - delay_random 0 10
    - play_effect Spark cube_dropper_spark_1
    - start_sound ZAP1 1 1 cube_dropper_spark_1

    - delay_random 0 10
    - play_effect Spark cube_dropper_spark_1
    - start_sound ZAP3 1 1 cube_dropper_spark_1

    - delay_random 0 10
    - play_effect Spark cube_dropper_spark_1
    - start_sound ZAP1 1 1 cube_dropper_spark_1

    - delay_random 0 10
    - play_effect Spark cube_dropper_spark_1
    - start_sound ZAP2 1 1 cube_dropper_spark_1

    - delay_random 0 10
    - play_effect Spark cube_dropper_spark_1
    - start_sound ZAP3 1 1 cube_dropper_spark_1

    - goto loop
  CUBE_DROPPER_SPARKS_2:
    - label loop

    - delay_random 0 15
    - play_effect Spark cube_dropper_spark_2
    - start_sound ZAP2 1 1 cube_dropper_spark_2

    - delay_random 0 15
    - play_effect Spark cube_dropper_spark_2
    - start_sound ZAP1 1 1 cube_dropper_spark_2

    - delay_random 0 15
    - play_effect Spark cube_dropper_spark_2
    - start_sound ZAP2 1 1 cube_dropper_spark_2

    - delay_random 0 15
    - play_effect Spark cube_dropper_spark_2
    - start_sound ZAP3 1 1 cube_dropper_spark_2

    - delay_random 0 15
    - play_effect Spark cube_dropper_spark_2
    - start_sound ZAP3 1 1 cube_dropper_spark_2

    - goto loop
operators:
  - near_cube_dropper = near_cube_dropper_1 or near_cube_dropper_2
  - not_cube_near_wall = not cube_near_wall
